<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SayHi! – Pengelolaan Akun</title>

  <!-- === HEAD TEMPLATE GLOBAL === -->
  <link rel="icon" href="gambar/logo.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="css/sayhi-theme.css">
  <link rel="stylesheet" href="css/app.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    (async function guard() {
      try {
        const r = await fetch("/sayhi/api/auth/me.php");
        const s = await r.json();
        if (!s.loggedIn) { location.href = "login.html"; }
      } catch (e) { location.href = "login.html"; }
    })();
  </script>
</head>

<body>
  <!-- === NAVBAR GLOBAL PLACEHOLDER === -->
  <div id="sayhi-navbar"></div>
  <div id="topbar"></div>

  <!-- === MAIN CONTENT === -->
  <main class="container my-4">
    <div class="row g-4">
      <!-- PROFIL -->
      <div class="col-lg-4">
        <div class="card p-4 text-center shadow-sm">
          <div class="avatar mx-auto mb-3" style="width:88px;height:88px;border-radius:50%;background:#ffd6db"></div>
          <h5 class="fw-bold mb-1">Admin SayHi</h5>
          <div class="text-muted small mb-3">@admin • admin@sayhi.test</div>

          <div class="mb-2">
            <input class="form-control mb-2" type="text" placeholder="Nama Tampilan">
            <input class="form-control mb-2" type="email" placeholder="Email">
            <input class="form-control mb-2" type="password" placeholder="Password baru">
            <input class="form-control" type="password" placeholder="Ulangi password">
          </div>

          <div class="d-flex justify-content-center gap-2 mt-3">
            <button class="btn btn-primary">Simpan Perubahan</button>
            <button class="btn btn-secondary">Keluar</button>
          </div>
        </div>
      </div>

      <!-- USERS & ROLES -->
      <div class="col-lg-8">
        <div class="card p-3 shadow-sm">
          <div class="d-flex justify-content-center gap-3 mb-3">
            <button class="btn btn-outline-primary tab active" data-tab="users">Users</button>
            <button class="btn btn-outline-primary tab" data-tab="roles">Roles</button>
          </div>

          <!-- USERS -->
          <div id="tab-users">
            <div class="d-flex justify-content-between flex-wrap gap-2 mb-3">
              <input class="form-control flex-grow-1" id="u-q" placeholder="Cari username / email">
              <button class="btn btn-success" id="btnAdd">+ Tambah User</button>
            </div>

            <div class="table-responsive">
              <table class="table align-middle table-striped" id="tblUsers">
                <thead class="table-light">
                  <tr>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Last Login</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- ROLES -->
          <div id="tab-roles" style="display:none">
            <h4 class="mb-3">Roles & Permissions</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="card p-3">
                  <strong>Admin</strong>
                  <ul class="mb-0">
                    <li>Kelola tamu</li>
                    <li>Lihat & ekspor laporan</li>
                    <li>Kelola users & roles</li>
                  </ul>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card p-3">
                  <strong>Viewer</strong>
                  <ul class="mb-0">
                    <li>Lihat daftar tamu</li>
                    <li>Lihat laporan</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- === SCRIPTS === -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="javascript/script.js"></script>

  <script>
    // Tabs handler
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(t => t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      ['users', 'roles'].forEach(id => {
        document.getElementById('tab-' + id).style.display = (t.dataset.tab === id) ? 'block' : 'none';
      });
    }));

    // Users dummy data
    const users = [
      { u: 'admin', role: 'Admin', status: 'Active', last: '2025-09-28 10:21' },
      { u: 'viewer1', role: 'Viewer', status: 'Suspended', last: '2025-09-20 12:00' }
    ];
    const tbody = document.querySelector('#tblUsers tbody');

    function renderUsers(list) {
      tbody.innerHTML = list.map(x => `
        <tr>
          <td>${x.u}</td>
          <td>${x.role}</td>
          <td>${x.status}</td>
          <td>${x.last}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="alert('Reset password ${x.u}')">Reset</button>
            <button class="btn btn-sm btn-info text-white" onclick="alert('Ubah ${x.u}')">Ubah</button>
          </td>
        </tr>`).join('');
    }

    renderUsers(users);

    document.getElementById('u-q').oninput = (e) => {
      const q = e.target.value.toLowerCase();
      renderUsers(users.filter(x => (x.u + x.role + x.status).toLowerCase().includes(q)));
    };

    document.getElementById('btnAdd').onclick = () =>
      alert('Form tambah user (modal) – sambungkan ke backend.');
  </script>
</body>

</html>
